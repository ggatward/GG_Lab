# Setup is TWO hosts - deploy runs on control-1, second host is compute-1


# Deploy oVirt VMs
ansible-playbook -i hosts_lab.ini -u svc-ansible --vault-id vault@prompt kolla_provision_ovirt.yml

# Apply generic config and hardening
ansible-playbook -i hosts_lab.ini -u svc-ansible --vault-id vault@prompt --limit kolla generic.yml
ansible-playbook -i hosts_lab.ini -u svc-ansible --vault-id vault@prompt --limit kolla hardening.yml

# Prep deploy host for kolla - initial run will need the extra_vars to do the swift setup
ansible-playbook -i hosts_lab.ini -u svc-ansible --vault-id vault@prompt kolla_prep_hosts.yml \
  -e 'swift_newrings=true' -e 'swift_formatdisks=true'


####################
#   Kolla Mods
# - /opt/venv/kolla/share/kolla-ansible/ansible/roles/prechecks/tasks/service_checks.yml
#     Had to comment out the block in that deals with docker version check


#############################################
#   Kolla Deploy
source /opt/venv/kolla/bin/activate
cd /etc/kolla
kolla-ansible -i inventory bootstrap-servers
kolla-ansible -i inventory pull
kolla-ansible -i inventory prechecks
kolla-ansible -i inventory deploy

# Get admin creds
kolla-ansible -i inventory post-deploy
